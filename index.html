<!DOCTYPE html>
<html lang="en">
    
<head>
    <link rel="stylesheet" href="style.css">
    <style>
@import url('https://fonts.googleapis.com/css2?family=DynaPuff:wght@400..700&display=swap');
</style>
    <title>Habit Tracker</title>
    <link rel="icon" type="image/x-icon" href="../iconpinkflower.png">
    <link href="https://fonts.cdnfonts.com/css/selvia-genatu" rel="stylesheet">
                
</head>
<body>
    <h1 id="title">Month</h1>
    <h2 id="subtitle">Monthly Habit Tracker</h2>

    <div id="calendarcontainer">
        <div id="calendardiv">
            <div id="calendarHeading">
                <p id="habittitle">My new habit</p>
                <p id="totaldays">0/31</p>
            </div>
            <div id="calendarcontent">
                <div id="Tracker">
                    <div class="days">
                        <div class="day">1</div>
                        <div class="day">2</div>
                        <div class="day">3</div>
                        <div class="day">4</div>
                        <div class="day">5</div>
                        <div class="day">6</div>
                    </div>
                    <div class="days">
                        <div class="day">7</div>
                        <div class="day">8</div>
                        <div class="day">9</div>
                        <div class="day">10</div>
                        <div class="day">11</div>
                        <div class="day">12</div>
                    </div><div class="days">
                        <div class="day">13</div>
                        <div class="day">14</div>
                        <div class="day">15</div>
                        <div class="day">16</div>
                        <div class="day">17</div>
                        <div class="day">18</div>
                    </div><div class="days">
                        <div class="day">19</div>
                        <div class="day">20</div>
                        <div class="day">21</div>
                        <div class="day">22</div>
                        <div class="day">23</div>
                        <div class="day">24</div>
                    </div><div class="days">
                        <div class="day">25</div>
                        <div class="day">26</div>
                        <div class="day">27</div>
                        <div class="day">28</div>
                        <div class="day">29</div>
                        <div class="day">30</div>
                        
                    </div><div class="days">
                        <div class="day">31</div>
                    </div>
                    
                </div>

            </div>
        </div>
    </div>
    <button id="resetbutton">Reset Button</button>
</body>
<script>
    /*get the date*/
    var date= new Date();
    console.log(date);

    /*get the current date info*/
    var currentMonth=date.getMonth();
    var currentDay=date.getDay();
    var currentDate=date.getDate();
    var currentYear=date.getFullYear();

    console.log("The current month is"+ currentMonth);
    console.log("The current day is" + currentDay);
    console.log("The current date is" + currentDate);
    console.log("The current year is"+currentYear);

    var months=[
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "August",
        "September",
        "October",
        "November",
        "December",
    ];
    var title = document.getElementById("title");
    title.innerHTML ="ðŸŒ¸"+ months[currentMonth]+"ðŸŒ¸";
    
    /*update the name of the habit*/
    var habittitle=document.getElementById("habittitle");
    habittitle.onclick=function(){
        let habits=prompt("What's your new habit?"+"ðŸ’—",habittitle.innerHTML)
        if(habits.length == 0){
            habittitle.innerHTML="click to add your habit"+"ðŸ’•";

        }else{
            habittitle.innerHTML=habits;
        }

    }

    /*set the total days*/
    var daysInTheMonthList = [31,28,31,30,31,30,31,31,30,31,30,31];
    var daysInThisMonth= daysInTheMonthList[currentMonth];
    var daysCompleted=0;
    var totaldays=document.getElementById("totaldays");
    totaldays.innerHTML="0/"+ daysInThisMonth;
    /* set the calendar days*/
    var daycount=0;
    var rowcount=0;
    var days= document.getElementsByClassName("days");
    /*for loop create ki hehe*/
    for(var i=0; i < days.length; i++){
        var day= days[rowcount].getElementsByClassName("day");
        for ( var j=0; j< day.length; j++){
            if(daycount == currentDate - 1){
                day[j].setAttribute("style","color:rgb(234,1,144);border:2px solid white");
            }
            if (daycount<daysInThisMonth) {
                day[j].innerHTML=daycount + 1;
                //todo: FIX
                day[j].setAttribute("id", "day" + (daycount + 1));
                daycount++;
            }else{
                day[j].innerHTML="";
                day[j].setAttribute("style","background-color:white;");
            }
        }
        rowcount++;
        /*a ye har aik row pr repeat hojaye gaw function ya jo bhi code humne likha hy hehe*/
    }
/*initialize completed array*/
var completed= new Array(31);
for(var i=0; i<daycount; i++){
    var tempString = (currentMonth + 1) + "-"+(i+1)+"-"+ currentYear;
    console.log("storing date:"+ tempString);
    var tempDay = localStorage.getItem(tempString);
    console.log(tempDay);
    if(tempDay == null || tempDay == "false"){
        localStorage.setItem(tempString,"false");
    }else if (tempDay == "true"){
        daysCompleted++;
    }
}
totaldays.innerHTML= daysCompleted + "/"+ daysInThisMonth;

/* check storage and update completed array */
for (var i = 0; i< daysInThisMonth; i++){
    var tempString = ""+(currentMonth+1)+"-"+(i+1)+"-"+ currentYear; // ADDED var tempString =
    console.log(tempString);

    var chosenDay = localStorage.getItem(tempString);
    console.log(i+1 + ": " + chosenDay);
    var chosenDayDiv = document.getElementById("day"+(i+1));
    if (chosenDay == "true"){
        chosenDayDiv.style.backgroundColor = "rgb(238, 136, 204)";
    }else if (chosenDay=="false"){
        chosenDayDiv.style.backgroundColor = "rgb(168, 148, 235)";
    }
}
/* Click on days to mark them complete */
for(var i = 1; i <= daysInThisMonth; i++){
    var dayDiv = document.getElementById("day" + i);
    console.log("day div : ",dayDiv);
    if(dayDiv){
        dayDiv.onclick = function(){
            var dayNumber = this.innerHTML;
            console.log("Day num",dayNumber)
             if(dayNumber > currentDate){
                alert("You can't log future days! ðŸ’•");
                return; // Stop the function here
            }
            var dateString = "" + (currentMonth + 1) + "-" + dayNumber + "-" + currentYear;
            
            var currentStatus = localStorage.getItem(dateString);
            
            if(currentStatus == "true"){
                // If already completed, mark as incomplete
                localStorage.setItem(dateString, "false");
                this.style.backgroundColor = "rgb(168, 148, 235)";
                daysCompleted--;
            } else {
                // Mark as completed
                localStorage.setItem(dateString, "true");
                this.style.backgroundColor = "rgb(238, 136, 204)";
                daysCompleted++;
            }
            
            // Update the total counter
            totaldays.innerHTML = daysCompleted + "/" + daysInThisMonth;
        }
    }
}
/* Reset Button */
var resetButton = document.getElementById("resetbutton");
resetButton.onclick = function(){
    var confirmReset = confirm("Are you sure you want to reset all your progress for " + months[currentMonth] + "? ðŸ’”");
    
    if(confirmReset){
        // Reset all days in localStorage for this month
        for(var i = 1; i <= daysInThisMonth; i++){
            var dateString = "" + (currentMonth + 1) + "-" + i + "-" + currentYear;
            localStorage.setItem(dateString, "false");
            
            // Reset the visual appearance
            var dayDiv = document.getElementById("day" + i);
            if(dayDiv && i <= daysInThisMonth){
                dayDiv.style.backgroundColor = "rgb(168, 148, 235)";
            }
        }
        
        // Reset the counter
        daysCompleted = 0;
        totaldays.innerHTML = "0/" + daysInThisMonth;
        
        alert("Your habit tracker has been reset! âœ¨");
    }
}


</script>

</html>
